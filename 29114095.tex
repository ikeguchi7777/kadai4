\documentclass[a4j]{jarticle}

\usepackage[dvipdfmx]{graphicx}
\usepackage{url}
\usepackage{listings,jlisting}
\usepackage{ascmac}
\usepackage{amsmath,amssymb}

%ここからソースコードの表示に関する設定
\lstset{
  basicstyle={\ttfamily},
  identifierstyle={\small},
  commentstyle={\smallitshape},
  keywordstyle={\small\bfseries},
  ndkeywordstyle={\small},
  stringstyle={\small\ttfamily},
  frame={tb},
  breaklines=true,
  columns=[l]{fullflexible},
  numbers=left,
  xrightmargin=0zw,
  xleftmargin=3zw,
  numberstyle={\scriptsize},
  stepnumber=1,
  numbersep=1zw,
  lineskip=-0.5ex
}
%ここまでソースコードの表示に関する設定

\title{知能プログラミング演習II 課題4}
\author{グループ07\\
  29114095 野竹浩二朗\\
%  {\small (グループレポートの場合は、グループ名および全員の学生番号と氏名が必要)}
}
\date{2019年11月11日}

\begin{document}
\maketitle

\paragraph{提出物} rep3
\paragraph{グループ} グループ07
\paragraph{メンバー}
\begin{tabular}{|c|c|c|}
  \hline\hline
  学籍番号&名前&貢献度\\
  \hline\hline
  29114007&池口弘尚&\\
  \hline
  29114031&大原拓人&\\
  \hline
  29114048&北原太一&\\
  \hline
  29114086&飛世裕貴&\\
  \hline
  29114095&野竹浩二朗&\\
  \hline
\end{tabular}



\section{課題の説明}
\begin{description}
\item[課題4-1] まず，教科書3.2.1の「前向き推論」のプログラムと教科書3.2.2の「後向き推論」のプログラムとの動作確認をし，前向き推論と後ろ向き推論の違いを説明せよ．また，実行例を示してルールが選択される過程を説明せよ．説明の際には，LibreOfficeのDraw（コマンド soffice --draw）などのドロー系ツールを使ってp.106 図3.11やp.118 図3.12のような図として示すことが望ましい．

\item[課題4-2] CarShop.data , AnimalWorld.data 等のデータファイルを実際的な応用事例（自分達の興味分野で良い）に書き換えて，前向き推論，および後ろ向き推論に基づく質問応答システムを作成せよ．どのような応用事例を扱うかは，メンバーで話し合って決めること．
なお，ユーザの質問は英語や日本語のような自然言語が望ましいが，難しければ変数を含むパターン等でも可とする．

\item[課題4-3] 上記4-2で実装した質問応答システムのGUIを作成せよ．
質問に答える際の推論過程を可視化できることが望ましい．

\item[課題4-4]上記4-3で実装したGUIを発展させ，質問応答だけでなく，ルールの編集（追加，削除，変更）などについてもGUIで行えるようにせよ．

\end{description}
私が担当したのは課題4-2,および課題4-4で用いるルールを追加するメソッド、削除するメソッドである。
\section{課題4-2}
\begin{screen}
CarShop.data , AnimalWorld.data 等のデータファイルを実際的な応用事例（自分達の興味分野で良い）に書き換えて，前向き推論，および後ろ向き推論に基づく質問応答システムを作成せよ．どのような応用事例を扱うかは，メンバーで話し合って決めること．
なお，ユーザの質問は英語や日本語のような自然言語が望ましいが，難しければ変数を含むパターン等でも可とする．
\end{screen}

\subsection{手法}
この課題ではスポーツに関するデータファイルを作成し,そのデータを用いて前向き推論、後ろ向き推論に基づいて処理をしていく。
私は自然言語ではなく、パターンによる処理ができるプログラムを作成した。

\subsection{実装}
データファイルの中身は以下のようになっている。
\begin{screen}
\begin{verbatim}
rule "Rule1"
if "We play ?x in the water"
then "?x is swimming"

rule "Rule2"
if "?x is swimming"
   "?x can be any way of swimming"
then "?x is freestyle"

rule "Rule3"
if "?x is swimming"
   "?x strokes hands in front of chest"
   "?x move one kick backward"
then "?x is breaststroke"
\end{verbatim}
\end{screen}
パターン認識には、以前の課題で作成したUnifyクラスを用いて、今回のRuleBaseSystem.javaのメインメソッドに以下のコードを追加した。
\begin{lstlisting}[caption=追加したコード]
    while(true){
      System.out.print("Enter Search Pattern:");
      String query = stdIn.nextLine();
      if(query.equals("exit")){
        break;
      }
      for(String st:rb.wm.assertions){
        (new Unifier()).unify(st,query);
      }
    }
\end{lstlisting}
「Enter Search Pattern:」の後に「We play ?x indoors」のように入力することで、入力されたパターンとマッチする文を出力する。

また、データファイル名、ワーキングメモリを書き込んだファイル名を読み込めるよう、RuleBaseクラスのRuleBaseメソッドに以下を追加した。
\begin{lstlisting}[caption=RuleBaseメソッド]
    System.out.print("Enter data-filename:"); // ファイル名の入力
    fileName = scan.nextLine();
    wm = new WorkingMemory();
    fm = new FileManager();

    System.out.print("Enter workingmemory-filename:");
    dataFilename = scan.nextLine();
    ArrayList<String> wms = fm.loadWm(dataFilename); //ワーキングメモリの取り込み
    for(String str : wms){
      wm.addAssertion(str);
    }
\end{lstlisting}
ルールやワーキングメモリに入れる文を変更する場合は、データファイルを変更する。

\subsection{実行例}
DataBaseSystemを実行した結果を以下に示す。ルールを追加する際、Rule1からRule34までが羅列されてしまい、実行結果が長くなってしまうため、一部省略している。(「...」の部分)
\begin{lstlisting}
Enter data-filename:data.txt
Enter workingmemory-filename:dataWm.txt
ADD:We play tennis outdoors
ADD:We use a ball in tennis
ADD:We use racket in tennis
Rule1 [We play ?x indoors]->?x is an indoor sport
Rule2 [We play ?x outdoors]->?x is an outdoor sport
...
Rule33 [?x is throwing competitions, We throw a hammmer in ?x]->?x is hammer throw
Rule34 [?x is throwing competitions, We throw a spear]->?x is javelin
apply rule:Rule1
apply rule:Rule2
Success: tennis is an outdoor sport
ADD:tennis is an outdoor sport
apply rule:Rule3
Success: tennis is a ball sport
ADD:tennis is a ball sport
apply rule:Rule4
apply rule:Rule5
...
apply rule:Rule32
apply rule:Rule33
apply rule:Rule34
Working Memory[We play tennis outdoors, We use a ball in tennis, We use racket in tennis, tennis is an outdoor sport, tennis is a ball sport]
apply rule:Rule1
apply rule:Rule2
apply rule:Rule24
apply rule:Rule25
apply rule:Rule26
apply rule:Rule27
apply rule:Rule28
apply rule:Rule29
apply rule:Rule30
apply rule:Rule31
apply rule:Rule32
apply rule:Rule33
apply rule:Rule34
Working Memory[We play tennis outdoors, We use a ball in tennis, We use racket in tennis, tennis is an outdoor sport, tennis is a ball sport]
No rule produces a new assertion

Enter Search Pattern:We play ?x indoors
Enter Search Pattern:We play ?x ?y
{?x=tennis, ?y=outdoors}
Enter Search Pattern:exit
\end{lstlisting}
ルールとワーキングメモリを読み込んだ後、探索するパターンを入力した結果を見ると、dataWm.txtの中身のデータとマッチする要素を取り出せていることが分かる。
\subsection{考察}
私が作成したプログラムでは、入力されたパターンによる検索しかできない。入力された文を単語ごとに分け、キーとなる単語、今回ではplayやindoorなどを識別することができれば自然言語処理に近い形ができると考えられる。

\section{課題4-4}
\begin{screen}
課題4-3で実装したGUIを発展させ，質問応答だけでなく，ルールの編集（追加，削除，変更）などについてもGUIで行えるようにせよ．
\end{screen}

\subsection{手法}

\subsection{実装}
私は、ルールを追加できるメソッドaddRulesと削除できるメソッドdeleteRulesを作成した。
まず、addRulesを示す。
\begin{lstlisting}[caption=addRulesメソッド]
void addRules(){
  String name = null;
  ArrayList<String> antecedents = null;
  String consequent = null;

  Scanner scan = new Scanner(System.in);
  System.out.println("--- Add Rule !!! ---");
  System.out.print("Enter RuleName:");
  name = scan.nextLine();
  System.out.print("Enter antecedent:");
  antecedents = new ArrayList<>();
  while(true){
    String a = scan.nextLine();
    if(a.equals("finish")) break;
    antecedents.add(a);
  }
  System.out.print("Enter consequent:");
  consequent = scan.nextLine();

  rules.add(new Rule(name,antecedents,consequent));
}
\end{lstlisting}
ルール名、条件、結果を標準入力で入力する。ルール名はString、条件はArrayList、結果はString型であり、入力されたあとルールを格納しているrulesに追加する。条件は、「finish」と入力されるまでいくつでも追加することができる。
次に、ルールを削除するdeleteRulesを示す。
\begin{lstlisting}[caption=deleteRulesメソッド]
void deleteRules(){
  Scanner scan = new Scanner(System.in);
  String name = null;

  System.out.println("--- Delete Rule !!! ---");
  System.out.print("Enter RuleName:");
  name = scan.nextLine();
  for(int i=0; i<rules.size();i++){
    if(rules.get(i).getName().equals(name)){
      rules.remove(i);
      i--;
    }
  }
}
\end{lstlisting}
ルールを削除する際はルール名のみを標準入力から読み込む。rules.get(i).getName()により、ルール名を順に呼び出し、入力されたルール名と一致したとき、rules.remove()により、要素を削除する。

ルールの追加、削除するかを選択できるよう、メインメソッドに以下も追加した。
\begin{lstlisting}
System.out.print("add rule? delete rule? add...1/delete...2/No thanks...3 :");
int j = stdIn.nextInt();
switch(j){
  case 1:
  rb.addRules();
  break;
  case 2:
  rb.deleteRules();
  break;
  case 3:
  break;
}
\end{lstlisting}
\subsection{実行結果}
ルールの追加、削除するメソッドを追加したDataBaseSystemを実行した結果を以下に示す。
\begin{lstlisting}
Enter data-filename:data.txt
Enter workingmemory-filename:dataWm.txt
ADD:We play tennis outdoors
ADD:We use a ball in tennis
ADD:We use racket in tennis
Rule1 [We play ?x indoors]->?x is an indoor sport
Rule2 [We play ?x outdoors]->?x is an outdoor sport
...
Rule33 [?x is throwing competitions, We throw a hammmer in ?x]->?x is hammer throw
Rule34 [?x is throwing competitions, We throw a spear]->?x is javelin
add rule? delete rule? add...1/delete...2/No thanks...3 :1
--- Add Rule !!! ---
Enter RuleName:Rule35
Enter antecedent:We play ?x space
finish
Enter consequent:?x is unknown
apply rule:Rule1
apply rule:Rule2
Success: tennis is an outdoor sport
ADD:tennis is an outdoor sport
apply rule:Rule3
Success: tennis is a ball sport
ADD:tennis is a ball sport
apply rule:Rule4
apply rule:Rule5
...
apply rule:Rule34
apply rule:Rule35
Working Memory[We play tennis outdoors, We use a ball in tennis, We use racket in tennis, tennis is an outdoor sport, tennis is a ball sport]
apply rule:Rule1
apply rule:Rule2
...
apply rule:Rule34
apply rule:Rule35
Working Memory[We play tennis outdoors, We use a ball in tennis, We use racket in tennis, tennis is an outdoor sport, tennis is a ball sport]
No rule produces a new assertion
...
\end{lstlisting}
ここでも、実行結果を省略して載せている。ルールの追加を選択後、3つの要素を入力するとaplly ruleにルールが反映されていることが確認できる。
\subsection{考察}
ルールを削除する際、ルール名を把握しなければならない。今回ではRuleXXというルールの番号が分かっていないと削除できないため、ルールの内容から検索、削除ができるようになればさらに汎用性が高いものができると考えたが、効率的にルールを検索する方法が思いつかず、今回はルール名を指定して削除する方法となってしまった。
\section{感想}


\end{document}